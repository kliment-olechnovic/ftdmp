<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
  a { color: #0000CC; }
  td { padding-right: 1em; }
  div#TOC > ul > li > ul > li ul { display: none; }
  </style>
</head>
<body>
<h1>FTDMP version 1.0</h1>
<div id="TOC">
<ul>
<li><a href="#about-ftdmp">About FTDMP</a></li>
<li><a href="#obtaining-and-installing-ftdmp">Obtaining and installing FTDMP</a><ul>
<li><a href="#getting-the-latest-version">Getting the latest version</a></li>
<li><a href="#building-the-included-software">Building the included software</a></li>
<li><a href="#installing">Installing</a></li>
<li><a href="#setting-miniconda-for-using-graph-neural-network-based-scoring-and-for-using-openmm">Setting Miniconda for using graph neural network-based scoring, and for using OpenMM</a></li>
</ul></li>
<li><a href="#using-ftdmp-for-scoring-and-ranking-multimeric-models">Using FTDMP for scoring and ranking multimeric models</a><ul>
<li><a href="#command-line-user-interface">Command line user interface</a></li>
<li><a href="#scoring-and-ranking-multimeric-protein-models-using-all-available-scoring-tools">Scoring and ranking multimeric protein models using all available scoring tools</a></li>
<li><a href="#scoring-and-ranking-multimeric-protein-models-without-using-graph-neural-networks">Scoring and ranking multimeric protein models without using graph neural networks</a></li>
<li><a href="#scoring-and-ranking-multimeric-models-that-include-rna-or-dna">Scoring and ranking multimeric models that include RNA or DNA:</a></li>
</ul></li>
<li><a href="#using-ftdmp-for-docking">Using FTDMP for docking</a><ul>
<li><a href="#command-line-user-interface-1">Command line user interface</a></li>
<li><a href="#example-of-protein-protein-docking-for-running-on-cluster">Example of protein-protein docking for running on cluster</a></li>
<li><a href="#example-of-protein-dna-docking-for-running-on-cluster">Example of protein-DNA docking for running on cluster</a></li>
</ul></li>
<li><a href="#using-ftdmp-for-relaxing-structures-with-openmm-to-remove-clashes-and-improve-interface-interactions">Using FTDMP for relaxing structures with OpenMM to remove clashes and improve interface interactions</a><ul>
<li><a href="#command-line-user-interface-2">Command line user interface</a></li>
<li><a href="#example-of-relaxing-multiple-complex-structures-containing-chains-of-different-types-protein-nucleic-acid">Example of relaxing multiple complex structures containing chains of different types (protein, nucleic acid)</a></li>
</ul></li>
</ul>
</div>
<h1 id="about-ftdmp">About FTDMP</h1>
<p>FTDMP is a software system for running docking experiments and scoring/ranking multimeric models.</p>
<p>FTDMP was used in CASP15 by the &quot;Venclovas&quot; team (Vilnius University / Life Sciences Center / Institute of Biotechnology). The most novel and useful features of FTDMP are integrated <strong>VoroIF-jury</strong> and <strong>VoroIF-GNN</strong> methods.</p>
<p>FTDMP has two main entry-point scripts:</p>
<ul>
<li><strong>ftdmp-all</strong> - script to perform docking and scoring/ranking.</li>
<li><strong>ftdmp-qa-all</strong> - script to perform scoring/ranking only - for example, to score a mix of models from different sources (docking, AlphaFold, RoseTTAFold).</li>
</ul>
<p>FTDMP uses several software tools that are included in the FTDMP package:</p>
<ul>
<li><strong>Voronota</strong> with its expansion Voronota-JS, namely the following executable:
<ul>
<li><strong>voronota-js</strong> (core engine that executes JavaScript scripts)</li>
<li><strong>voronota-js-voromqa</strong> (wrapper to a voronota-js program for computing VoroMQA scores, both old and new (developed for CASP14))</li>
<li><strong>voronota-js-only-global-voromqa</strong> (wrapper to a voronota-js program for computing only global VoroMQA scores with fast caching)</li>
<li><strong>voronota-js-fast-iface-voromqa</strong> (wrapper to a voronota-js program for the very fast computation of the inter-chain interface VoroMQA energy)</li>
<li><strong>voronota-js-fast-iface-cadscore</strong> (wrapper to a voronota-js program for the very fast computation of the inter-chain interface CAD-score)</li>
<li><strong>voronota-js-fast-iface-cadscore-matrix</strong> (wrapper to a voronota-js program for the very fast computation of the inter-chain interface CAD-score matrix)</li>
<li><strong>voronota-js-fast-iface-data-graph</strong> (wrapper to a voronota-js program for the computation of interface graphs used by the VoroIF-GNN method)</li>
<li><strong>voronota-js-voroif-gnn</strong> (wrapper to a voronota-js program and GNN inference scripts that run the VoroIF-GNN method for scoring models of protein-protein complexes (developed for CASP15))</li>
</ul></li>
<li><strong>FTDock</strong> (a modified version of a popular rigid-body-docking software tool), it depends on &quot;fftw-2.1.5&quot; that is also included</li>
<li><strong>FASPR</strong> (a fast tool for rebuilding sidechains in protein structures)</li>
</ul>
<p>FTDMP also can use non-open-source docking tools that are not included in the FTDMP package, but can be easily installed separately:</p>
<ul>
<li><strong>HEX</strong> (a rigid-body-docking software tool)</li>
<li><strong>SAM</strong> (a symmetry-docking software tool)</li>
</ul>
<p>Some features of FTDMP require aditional dependencies (that are easily available through &quot;conda&quot; package manager):</p>
<ul>
<li>graph neural network-based scoring using &quot;voronota-js-voroif-gnn&quot; requires &quot;R&quot;, &quot;PyTorch&quot; and &quot;PyTorch Geometric&quot;</li>
<li>relaxing using molecular dynamics requires &quot;OpenMM&quot;</li>
</ul>
<h1 id="obtaining-and-installing-ftdmp">Obtaining and installing FTDMP</h1>
<h2 id="getting-the-latest-version">Getting the latest version</h2>
<p>The currently recommended way to obtain FTDMP is cloning the FTDMP git repository:</p>
<pre><code>git clone https://github.com/kliment-olechnovic/ftdmp.git
cd ./ftdmp</code></pre>
<h2 id="building-the-included-software">Building the included software</h2>
<p>To build all the included dependencies, run the following command:</p>
<pre><code>./core/build.bash</code></pre>
<h2 id="installing">Installing</h2>
<p>To, optionally, make FTDMP accessible without specifying full path, add the following line at the end of &quot;.bash_profile&quot; or &quot;.bashrc&quot;:</p>
<pre><code>export PATH=&quot;/path/to/ftdmp:${PATH}&quot;</code></pre>
<h2 id="setting-miniconda-for-using-graph-neural-network-based-scoring-and-for-using-openmm">Setting Miniconda for using graph neural network-based scoring, and for using OpenMM</h2>
<p>Download the Miniconda package:</p>
<pre><code>cd ~/Downloads
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</code></pre>
<p>Install Miniconda:</p>
<pre><code>bash Miniconda3-latest-Linux-x86_64.sh</code></pre>
<p>Activate Miniconda environment:</p>
<pre><code>source ~/miniconda3/bin/activate</code></pre>
<p>Install packages for using graph neural network-based scoring:</p>
<pre><code>conda install pytorch torchvision torchaudio pytorch-cuda=11.7 -c pytorch -c nvidia # using instructions from &#39;https://pytorch.org/get-started/locally/&#39;
conda install pyg -c pyg # using instructions from &#39;https://pytorch-geometric.readthedocs.io/en/latest/install/installation.html&#39;
conda install pandas
conda install r # may skip this if you have R already and do not want it in Miniconda</code></pre>
<p>Test PyTorch installation:</p>
<pre><code>python -c &quot;import torch; print(torch.__version__)&quot;</code></pre>
<p>Install packages for using OpenMM:</p>
<pre><code>conda install -c conda-forge libstdcxx-ng # needed for the compatible version of libstdc++
conda install -c conda-forge openmm
conda install -c conda-forge pdbfixer</code></pre>
<p>Test OpenMM installation:</p>
<pre><code>python -m openmm.testInstallation</code></pre>
<h1 id="using-ftdmp-for-scoring-and-ranking-multimeric-models">Using FTDMP for scoring and ranking multimeric models</h1>
<p>Scoring and ranking is done with the 'ftdmp-qa-all' script. Below is the breef description of 'ftdmp-qa-all' interface.</p>
<h2 id="command-line-user-interface">Command line user interface</h2>
<pre><code>&#39;ftdmp-qa-all&#39; scores and ranks multimeric structures of proteins or nucleic acids

Options:
    --workdir                         string  *  path to directory for caching and writing detailed results
    --subselect-contacts              string     query to subselect inter-chain contacts for scoring, default is &#39;[]&#39;
    --constraints-required            string     query to check required inter-chain contacts, default is &#39;&#39;
    --constraints-banned              string     query to check banned inter-chain contacts, default is &#39;&#39;
    --constraint-clashes              number     max allowed clash score, default is &#39;&#39;
    --subselect-atoms-global          string     query to subselect atoms for global scores, default is &#39;[]&#39;
    --reference                       string     input structure file to compute CAD-score with, default is &#39;&#39;
    --ftdmp-root                      string     ftdmp root path, default is &#39;&#39; (autodetected from the calling command)
    --conda-path                      string     conda installation path, default is &#39;&#39;
    --conda-early                     string     flag to activate conda as early as possible
    --conda-env                       string     conda main environment name, default is &#39;&#39;
    --processors                      number     number of processes to run when scoring, default is 8
    --sbatch                          string     sbatch parameters to run scoring in parallel, default is &#39;&#39;
    --score-symmetry                  string     flag to score symmetry, default is &#39;false&#39;
    --external-scores                 string     path to input file with external scores table, default is &#39;&#39;
    --remap-cadscore                  string     flag to use optimal chains remapping for CAD-score, default is &#39;false&#39;
    --crude-cadscore                  string     flag to use faster but crude mode for CAD-score
    --keep-top-fast                   number     number of top complexes to keep after full scoring stage, default is 9999999
    --keep-top-slow                   number     number of top complexes to keep before slow full scoring stage, default is 9999999
    --limit-voromqa-light             number     minimal allowed VoroMQA-light whole-stricture score, default is &#39;&#39;
    --rank-names                      string     rank names to use, or name of a standard set of rank names, default is &#39;protein_protein_voromqa_and_global_and_gnn_no_sr&#39;
    --ranks-top                       number     number of top complexes to consider for each ranking, default is 9999999
    --jury-slices                     string     slice sizes sequence definition for ranks jury scoring, default is &#39;5 20&#39;
    --jury-cluster                    number     clustering threshold for ranks jury scoring, default is 0.9
    --jury-maxs                       number     number of max values to use for ranks jury scoring, default is 1
    --output-redundancy-threshold     number     minimal ordered redundancy value to accept, default is 0.9
    --plot-jury-scores                string     file path to output plot of jury scores, default is &#39;&#39;
    --plot-jury-diagnostics           string     flag to plot jury diagnostics, default is &#39;false&#39;
    --write-pdb-file                  string     file path template to output scores in PDB files, default is &#39;&#39;
    --write-pdb-mode                  string     mode for PDB scores output (&#39;voromqa_dark&#39; or &#39;voromqa_dark_and_gnn&#39;), default is &#39;voromqa_dark_and_gnn&#39;
    --write-pdb-num                   number     number of top PDB files with scores to write, default is 5
    --write-full-table                string     file path to output full table, default is &#39;&#39;
    --help | -h                                  flag to display help message and exit

Standard input:
    input file paths

Standard output:
    space-separated table of scores

Examples:

    ls ./*.pdb | ftdmp-qa-all --conda-path ~/miniconda3 --workdir &#39;./tmp/works&#39; --rank-names protein_protein_voromqa_and_global_and_gnn_no_sr
    
    ls ./*.pdb | ftdmp-qa-all --workdir &#39;./tmp/works&#39; --rank-names protein_protein_voromqa_no_sr
    
    ls ./*.pdb | ftdmp-qa-all --conda-path ~/miniconda3 --workdir &#39;./tmp/works&#39; --rank-names protein_protein_voromqa_and_global_and_gnn_no_sr \
        --write-pdb-file &#39;./output/scored_-RANK-_-BASENAME-&#39; --write-pdb-mode &#39;voromqa_dark_and_gnn&#39; --write-pdb-num 5

Named collections of rank names, to be provided as a single string to &#39;--rank-names&#39;:

    protein_protein_voromqa_and_global_and_gnn_no_sr
    protein_protein_voromqa_and_global_and_gnn_with_sr
    protein_protein_voromqa_and_gnn_no_sr
    protein_protein_voromqa_and_gnn_with_sr
    protein_protein_voromqa_no_sr
    protein_protein_voromqa_with_sr
    protein_protein_simplest_voromqa
    generalized_voromqa</code></pre>
<h2 id="scoring-and-ranking-multimeric-protein-models-using-all-available-scoring-tools">Scoring and ranking multimeric protein models using all available scoring tools</h2>
<p>Example of scoring using only interface-focused methods:</p>
<pre><code>ls ./*.pdb \
| ftdmp-qa-all \
  --rank-names protein_protein_voromqa_and_gnn_no_sr \
  --conda-path ~/miniconda3 \
  --workdir &#39;./works&#39;</code></pre>
<p>Example of scoring using both interface-focused and whole-structure methods:</p>
<pre><code>ls ./*.pdb \
| ftdmp-qa-all \
  --rank-names protein_protein_voromqa_and_global_and_gnn_no_sr \
  --conda-path ~/miniconda3 \
  --workdir &#39;./works&#39;</code></pre>
<h2 id="scoring-and-ranking-multimeric-protein-models-without-using-graph-neural-networks">Scoring and ranking multimeric protein models without using graph neural networks</h2>
<p>Example of scoring with rebuilding side-chains:</p>
<pre><code>ls ./*.pdb \
| ftdmp-qa-all \
  --rank-names protein_protein_voromqa_with_sr \
  --workdir &#39;./works&#39;</code></pre>
<p>Example of scoring without rebuilding side-chains:</p>
<pre><code>ls ./*.pdb \
| ftdmp-qa-all \
  --rank-names protein_protein_voromqa_no_sr \
  --workdir &#39;./works&#39;</code></pre>
<h2 id="scoring-and-ranking-multimeric-models-that-include-rna-or-dna">Scoring and ranking multimeric models that include RNA or DNA:</h2>
<p>Example of scoring:</p>
<pre><code>ls ./*.pdb \
| ftdmp-qa-all \
  --rank-names generalized_voromqa \
  --workdir &#39;./works&#39;</code></pre>
<h1 id="using-ftdmp-for-docking">Using FTDMP for docking</h1>
<h2 id="command-line-user-interface-1">Command line user interface</h2>
<p>Docking and scoring is done with the 'ftdmp-all' script. Below is the breef description of 'ftdmp-all' interface.</p>
<pre><code>&#39;ftdmp-all&#39; docks, scores and ranks complex structures of proteins or nucleic acids

Options:
    --job-name                string  *  job name
    --pre-docked-input-dir    string     pre-docked input directory path 
    --static-file             string     hetero docking static input file path
    --static-sel              string     hetero docking query to restrict static atoms, default is &#39;[]&#39;
    --static-chain            string     hetero docking chain name or chain renaming rule to apply for static atoms, default is &#39;&#39;
    --static-rotation-seed    number     random seed to initially rotate static part, default is 1
    --mobile-file             string     hetero or homo docking mobile input file path
    --mobile-sel              string     hetero or homo docking query to restrict mobile atoms, default is &#39;[]&#39;
    --mobile-chain            string     hetero or homo docking chain name or chain renaming rule to apply for mobile atoms, default is &#39;&#39;
    --mobile-rotation-seed    number     random seed to initially rotate mobile part, default is 2
    --symmetry-docking        string     homo docking symmetry to apply for the mobile input file, default is &#39;&#39;
    --subselect-contacts      string     query to subselect inter-chain contacts for scoring, default is &#39;[]&#39;
    --constraints-required    string     query to check required inter-chain contacts, default is &#39;&#39;
    --constraints-banned      string     query to check banned inter-chain contacts, default is &#39;&#39;
    --constraint-clashes      number     max allowed clash score, default is &#39;&#39;
    --reference               string     input structure file to compute CAD-score with, default is &#39;&#39;
    --openmm-forcefield       string     forcefield name for OpenMM-based operations, default is &#39;&#39;
    --ftdmp-root              string     ftdmp root path, default is &#39;&#39; (autodetected from the calling command)
    --conda-path              string     conda installation path, default is &#39;&#39;
    --conda-early             string     flag to activate conda as early as possible
    --conda-env               string     conda main environment name, default is &#39;&#39;
    --conda-env-for-gnn       string     conda GNN environment name, equals the main environment name if not set
    --sam-parameters          string     additional SAM parameters, default is &#39;-top=8000 -show=2000 -clusters=2000&#39;
    --use-ftdock              string     flag to use ftdock, default is &#39;true&#39;
    --use-hex                 string     flag to use HEX, default is &#39;false&#39;
    --ftdock-keep             number     ftdock keep parameter, default is 1
    --ftdock-angle-step       number     ftdock angle step parameter, default is 9
    --ftdock-min-grid-sep     number     minimum grid separation between same-rotation translations, default is 20
    --hex-macro-mode          string     flag to enable HEX macro mode, default is &#39;true&#39;
    --hex-max-solutions       number     max number of docking solutions for HEX, default is 10000
    --hex-script              string     semicolon-sparated additional commands for HEX, default is &#39;&#39;
    --hex-swap-and-repeat     string     flag to run HEX twice with monomers swapped, default is &#39;false&#39;
    --parallel-docking        number     number of processes to run when docking, default is 8
    --parallel-scoring        number     number of processes to run when scoring, default is 8
    --cache-dir               string     cache directory path to store results of past slower calculations
    --sbatch-for-ftdock       string     sbatch parameters to run docking with ftdock in parallel, default is &#39;&#39;
    --sbatch-for-hex-or-sam   string     sbatch parameters to run docking with HEX or SAM on cluster, default is &#39;&#39;
    --sbatch-scoring          string     sbatch parameters to run scoring in parallel, default is &#39;&#39;
    --score-symmetry          string     flag to score symmetry, default is &#39;false&#39;
    --local-columns           string     flag to add per-residue scores to the global output table, default is &#39;false&#39;
    --remap-cadscore          string     flag to use optimal chains remapping for CAD-score, default is &#39;false&#39;
    --scoring-full-top        number     number of top complexes to keep after full scoring stage, default is 1000
    --scoring-full-top-slow   number     number of top complexes to keep before slow full scoring stage, default is 9999999
    --scoring-rank-names      string  *  rank names to use, or name of a standard set of rank names
    --scoring-ranks-top       number     number of top complexes to consider for each ranking, default is 100
    --scoring-jury-slices     string     slice sizes sequence definition for ranks jury scoring, default is &#39;5 20&#39;
    --scoring-jury-cluster    number     clustering threshold for ranks jury scoring, default is 0.9
    --scoring-jury-maxs       number     number of max values to use for ranks jury scoring, default is 1
    --redundancy-threshold    number     minimal ordered redundancy value to accept, default is 0.9
    --build-complexes         number     number of top complexes to build, default is 0
    --multiply-chains         string     options to multiply chains, default is &#39;&#39;
    --relax-complexes         string     options to relax complexes, default is &#39;&#39;
    --only-dock-and-score     string     flag to only dock, score and quit after scoring, default is &#39;false&#39;
    --diversify               number     step of CAD-score to diversify scoring results and exit, default is &#39;&#39;
    --plot-jury-scores        string     flag to output plot of jury scores, default is &#39;false&#39;
    --casp15-qa               string     flag to output CASP15 QA answer, default is &#39;false&#39;
    --casp15-qa-target        string     target name for outputting CASP15 QA answer, default is &#39;_THETARGET_&#39;
    --casp15-qa-author-id     string     author ID for outputting CASP15 QA answer, default is &#39;_THEAUTHOR_&#39;
    --output-dir              string  *  output directory path
    --help | -h                          flag to display help message and exit

Examples:

    ftdmp-all --job-name &#39;j1&#39; --static-file &#39;./chainA.pdb&#39; --mobile-file &#39;./chainB.pdb&#39; \
      --scoring-rank-names &#39;standard_for_protein_protein&#39; --output-dir &#39;./results&#39;

    ftdmp-all --job-name &#39;j2&#39; --pre-docked-input-dir &#39;./predocked&#39; \
      --scoring-rank-names &#39;standard_for_protein_protein&#39; --output-dir &#39;./results&#39;

Named collections of rank names, to be provided as a single string to &#39;--scoring-rank-names&#39;:

    protein_protein_voromqa_and_global_and_gnn_no_sr
    protein_protein_voromqa_and_global_and_gnn_with_sr
    protein_protein_voromqa_and_gnn_no_sr
    protein_protein_voromqa_and_gnn_with_sr
    protein_protein_voromqa_no_sr
    protein_protein_voromqa_with_sr
    protein_protein_simplest_voromqa
    generalized_voromqa</code></pre>
<h2 id="example-of-protein-protein-docking-for-running-on-cluster">Example of protein-protein docking for running on cluster</h2>
<p>Example script:</p>
<pre><code>#!/bin/bash

STATICFILE=&quot;./input/bigger_molecule.pdb&quot;
MOBILEFILE=&quot;./input/smaller_molecule.pdb&quot;
JOBNAME=&quot;$(basename ${STATICFILE} .pdb)__$(basename ${MOBILEFILE} .pdb)&quot;

sbatch --job-name=rdwf --partition=Cluster --ntasks=1 --cpus-per-task=1 --mem-per-cpu=4000 \
${HOME}/git/ftdmp/ftdmp-all \
  --ftdmp-root ${HOME}/git/ftdmp \
  --conda-path ${HOME}/miniconda3 \
  --conda-early &#39;true&#39; \
  --parallel-docking 64 \
  --parallel-scoring 128 \
  --sbatch-for-ftdock &#39;--job-name=ftdock --partition=Cluster --ntasks=1 --cpus-per-task=1 --mem-per-cpu=8000&#39; \
  --sbatch-for-hex-or-sam &#39;--job-name=hexsam --partition=Cluster --ntasks=1 --cpus-per-task=8 --mem-per-cpu=8000&#39; \
  --sbatch-scoring &#39;--job-name=dscore --partition=Cluster --ntasks=1 --cpus-per-task=1 --mem-per-cpu=8000&#39; \
  --job-name &quot;$JOBNAME&quot; \
  --output-dir ./output \
  --static-file &quot;$STATICFILE&quot; \
  --static-sel &#39;[]&#39; \
  --static-chain &#39;D=A,E=B&#39; \
  --mobile-file &quot;$MOBILEFILE&quot; \
  --mobile-sel &#39;[]&#39; \
  --mobile-chain &#39;C&#39; \
  --subselect-contacts &#39;[-a1 [-chain A,B] -a2 [-chain C]]&#39; \
  --use-ftdock &#39;true&#39; \
  --use-hex &#39;false&#39; \
  --constraint-clashes 0.5 \
  --ftdock-keep 5 \
  --ftdock-angle-step 5 \
  --scoring-rank-names &#39;protein_protein_voromqa_and_global_and_gnn_no_sr&#39; \
  --scoring-full-top 3000 \
  --scoring-ranks-top 100 \
  --scoring-jury-maxs 1 \
  --scoring-jury-slices &#39;5 20&#39; \
  --scoring-jury-cluster &quot;$(seq 0.70 0.01 0.90)&quot; \
  --redundancy-threshold 0.7 \
  --build-complexes 200 \
  --openmm-forcefield &#39;amber99sb&#39; \
  --relax-complexes &#39;--max-iterations 0 --focus whole_interface&#39; \
  --cache-dir ./cache</code></pre>
<h2 id="example-of-protein-dna-docking-for-running-on-cluster">Example of protein-DNA docking for running on cluster</h2>
<p>Example script:</p>
<pre><code>#!/bin/bash

STATICFILE=&quot;./input/bigger_molecule.pdb&quot;
MOBILEFILE=&quot;./input/smaller_molecule.pdb&quot;
JOBNAME=&quot;$(basename ${STATICFILE} .pdb)__$(basename ${MOBILEFILE} .pdb)&quot;

sbatch --job-name=rdwf --partition=Cluster --ntasks=1 --cpus-per-task=1 --mem-per-cpu=4000 \
${HOME}/git/ftdmp/ftdmp-all \
  --ftdmp-root ${HOME}/git/ftdmp \
  --conda-path ${HOME}/miniconda3 \
  --conda-early &#39;true&#39; \
  --parallel-docking 32 \
  --parallel-scoring 64 \
  --sbatch-for-ftdock &#39;--job-name=ftdock --partition=Cluster --ntasks=1 --cpus-per-task=1 --mem-per-cpu=8000&#39; \
  --sbatch-for-hex-or-sam &#39;--job-name=hexsam --partition=Cluster --ntasks=1 --cpus-per-task=8 --mem-per-cpu=8000&#39; \
  --sbatch-scoring &#39;--job-name=dscore --partition=Cluster --ntasks=1 --cpus-per-task=1 --mem-per-cpu=8000&#39; \
  --job-name &quot;$JOBNAME&quot; \
  --output-dir ./output \
  --static-file &quot;$STATICFILE&quot; \
  --static-sel &#39;[]&#39; \
  --static-chain &#39;A&#39; \
  --mobile-file &quot;$MOBILEFILE&quot; \
  --mobile-sel &#39;(not [-rnum 1 -aname P,O1P,O2P])&#39; \
  --mobile-chain &#39;A=B,B=C&#39; \
  --subselect-contacts &#39;[-a1 [-chain A] -a2 [-chain B,C]]&#39; \
  --use-ftdock &#39;true&#39; \
  --use-hex &#39;false&#39; \
  --constraint-clashes 0.9 \
  --ftdock-keep 5 \
  --ftdock-angle-step 5 \
  --scoring-rank-names &#39;generalized_voromqa&#39; \
  --scoring-full-top 3000 \
  --scoring-ranks-top 200 \
  --scoring-jury-maxs 1 \
  --scoring-jury-slices &#39;5 50&#39; \
  --scoring-jury-cluster &quot;$(seq 0.70 0.01 0.90)&quot; \
  --redundancy-threshold 0.7 \
  --build-complexes 200 \
  --openmm-forcefield &#39;amber14-all-no-water&#39; \
  --relax-complexes &#39;--max-iterations 10 --focus whole_interface&#39; \
  --cache-dir ./cache</code></pre>
<p>Main essential changes when compared with the protei-protein docking case:</p>
<pre><code>--scoring-rank-names &#39;generalized_voromqa&#39;

--openmm-forcefield &#39;amber14-all-no-water&#39;                        # now using a force field that is compatible with DNA and RNA
--relax-complexes &#39;--max-iterations 10 --focus whole_interface&#39;   # now using iterations limit to not overdo the relaxation in absence of water</code></pre>
<h1 id="using-ftdmp-for-relaxing-structures-with-openmm-to-remove-clashes-and-improve-interface-interactions">Using FTDMP for relaxing structures with OpenMM to remove clashes and improve interface interactions</h1>
<h2 id="command-line-user-interface-2">Command line user interface</h2>
<p>Relaxing is done with the 'ftdmp-relax-with-openmm' script. After relaxing, model structures can be rescored and reranked with the 'ftdmp-qa-all' script. It is advised to do it on a machine with a nice GPU. Below is the breef description of 'ftdmp-relax-with-openmm' interface.</p>
<pre><code>&#39;ftdmp-relax-with-openmm&#39; script relaxes a molecular structure using OpenMM.

Options:
    --input                   string  *  input file path
    --output                  string  *  output file path, setting to &#39;_same_as_input&#39; will overwrite input file
    --focus                   string     focus mode, default is &#39;whole_structure&#39;, others are: &#39;interface_side_chains&#39;, &#39;whole_interface&#39;, &#39;not_interface&#39;
    --focus-base              string     selection of atoms that can be in a partial structure focus, default is &#39;[]&#39;
    --focus-first-sel         string     first selection of atoms to define interface not by chains, default is &#39;&#39;
    --focus-second-sel        string     second selection of atoms to define interface not by chains, default is &#39;&#39;
    --conda-path              string     conda installation path, default is &#39;&#39;
    --conda-env               string     conda environment name, default is &#39;&#39;
    --forcefield              string     forcefield combo name, default is &#39;amber99sb&#39;, others are: &#39;amber14-all&#39;, &#39;amber14-all-no-water&#39;, &#39;charmm36&#39;
    --main-forcefield         string     main forcefield name, default is defined by the combo name, some others are: &#39;amber99sb&#39;, &#39;amber14-all&#39;, &#39;charmm36&#39;
    --water-forcefield        string     water forcefiled name, default is defined by the combo name, some others are: &#39;&#39;, &#39;amber99_obc&#39;, &#39;amber14/tip3pfb&#39;, &#39;charmm36/water&#39;
    --max-iterations          number     max number of iterations, default is 100
    --score-at-end            string     mode for scoring interface at the end, default is &#39;&#39;, others are: &#39;fast_iface&#39;, &#39;full_iface&#39;, &#39;full&#39;
    --scoring-params          string     additional parameters for scoring, default is &#39;&#39;
    --multiple-tries          number     number of tries to generate and score interfaces, default is &#39;&#39;
    --cache-dir               string     cache directory path to store results of past calls
    --force-cuda                         flag to force the platform to be CUDA
    --trim-output                        flag to restrict output to atoms of proteins and nucleic acids
    --no-preparation                     flag to not run any preparation of input structure before simulations
    --limit-preparation                  flag to only add solvent if needed in the preparation stage
    --full-preparation                   flag to turn off all preparation disabling flags
    --no-simulation                      flag to not run any simulations
    --help | -h                          flag to display help message and exit

Standard output:
    space-separated table of scores for both input and output
    
Examples:

    ftdmp-relax-with-openmm --input model.pdb --output relaxed_model.pdb
    
    ftdmp-relax-with-openmm --conda-path ~/miniconda3 --forcefield amber14-all \
      -i model.pdb -o relaxed_model.pdb --score-at-end fast_iface --trim-output</code></pre>
<h2 id="example-of-relaxing-multiple-complex-structures-containing-chains-of-different-types-protein-nucleic-acid">Example of relaxing multiple complex structures containing chains of different types (protein, nucleic acid)</h2>
<p>Using the 'amber14-all-no-water' forcefield, the example below works for protein-protein, protein-nucleic acid, and nucleic acid-nucleic acid interfaces.</p>
<pre><code>find &quot;./models/raw/&quot; -type f -name &#39;*.pdb&#39; \
| while read -r INFILE
do
    OUTFILE=&quot;./models/relaxed/$(basename ${INFILE})&quot;
    
    ${HOME}/git/ftdmp/ftdmp-relax-with-openmm \
        --conda-path ${HOME}/miniconda3 \
        --conda-env &#39;&#39; \
        --force-cuda \
        --full-preparation \
        --forcefield &#39;amber14-all-no-water&#39; \
        --max-iterations 10 \
        --focus &quot;whole_interface&quot; \
        --input &quot;$INFILE&quot; \
        --output &quot;$OUTFILE&quot; \
        --cache-dir ./workdir/relax_cache
done</code></pre>
</body>
</html>
